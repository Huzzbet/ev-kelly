<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>EV & Kelly App</title>
  <meta name="description" content="Fast stake sizing with edge, EV, and fractional Kelly — with an NBL helper tab." />
  <link rel="icon" href="data:,">
  <!-- Tailwind CDN (no build needed) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { ui: ['ui-sans-serif', 'system-ui', 'Segoe UI', 'Roboto', 'Helvetica', 'Apple Color Emoji', 'Arial', 'sans-serif'] }
        }
      },
      darkMode: 'class'
    }
  </script>
  <style>
    /* iOS safe-area padding for full-bleed feel */
    .safe { padding-left: env(safe-area-inset-left); padding-right: env(safe-area-inset-right); }
    /* Compact tap targets */
    .btn { @apply px-3 py-2 rounded-md text-sm font-medium; }
    .seg { @apply inline-flex items-center justify-center px-3 py-2 text-sm font-medium rounded-md; }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  </style>
</head>

<body class="bg-black text-zinc-100 font-ui selection:bg-zinc-700">
  <header class="safe sticky top-0 z-30 bg-black/85 backdrop-blur border-b border-zinc-800">
    <div class="max-w-screen-sm mx-auto flex items-center justify-between py-3">
      <div class="min-w-0">
        <h1 class="text-lg font-semibold leading-tight">EV & Kelly App</h1>
        <p class="text-xs text-zinc-400">Fast stake sizing with edge, EV & fractional Kelly.</p>
      </div>
      <a href="https://github.com/huzzbet/huzzbet.github.io" class="text-xs text-zinc-400 underline decoration-dotted" target="_blank" rel="noreferrer">Source</a>
    </div>
    <!-- Tabs -->
    <nav class="max-w-screen-sm mx-auto pb-2">
      <div id="tabs" class="grid grid-cols-3 gap-2 px-3">
        <button data-tab="kelly" class="seg bg-zinc-800">Kelly</button>
        <button data-tab="ev" class="seg bg-zinc-900">EV</button>
        <button data-tab="nbl" class="seg bg-zinc-900">NBL Helper</button>
      </div>
    </nav>
  </header>

  <main class="safe max-w-screen-sm mx-auto px-3 pt-3 pb-28 space-y-6">

    <!-- KELLY TAB -->
    <section data-panel="kelly" class="space-y-4">
      <h2 class="sr-only">Kelly Sizing</h2>

      <div class="grid grid-cols-2 gap-3">
        <label class="block">
          <span class="text-xs text-zinc-400">Decimal Odds</span>
          <input id="k-odds" type="number" step="0.01" min="1.01"
                 class="mt-1 w-full bg-zinc-900 border border-zinc-800 rounded-md px-3 py-2"
                 placeholder="e.g., 2.10">
        </label>
        <label class="block">
          <span class="text-xs text-zinc-400">Win Prob. (p %)</span>
          <input id="k-prob" type="number" step="0.1" min="0" max="100"
                 class="mt-1 w-full bg-zinc-900 border border-zinc-800 rounded-md px-3 py-2"
                 placeholder="e.g., 52">
        </label>
      </div>

      <div class="grid grid-cols-2 gap-3">
        <label class="block">
          <span class="text-xs text-zinc-400">Bankroll ($)</span>
          <input id="k-bank" type="number" step="1" min="0"
                 class="mt-1 w-full bg-zinc-900 border border-zinc-800 rounded-md px-3 py-2"
                 placeholder="e.g., 5000">
        </label>
        <label class="block">
          <span class="text-xs text-zinc-400">Fraction (0–1)</span>
          <input id="k-frac" type="number" step="0.05" min="0" max="1"
                 class="mt-1 w-full bg-zinc-900 border border-zinc-800 rounded-md px-3 py-2"
                 value="0.5" placeholder="0.5 = half Kelly">
        </label>
      </div>

      <div class="flex gap-2">
        <button id="k-calc" class="btn bg-white/90 text-black">Calculate</button>
        <button id="k-clear" class="btn bg-zinc-800">Clear</button>
      </div>

      <div id="k-out" class="rounded-lg border border-zinc-800 bg-zinc-900 p-3 text-sm space-y-1 hidden">
        <div class="flex items-center justify-between"><span class="text-zinc-400">Kelly % (full)</span><strong id="k-kellyPct">—</strong></div>
        <div class="flex items-center justify-between"><span class="text-zinc-400">Stake @ Fraction</span><strong id="k-stake">—</strong></div>
        <div class="flex items-center justify-between"><span class="text-zinc-400">EV per $1</span><strong id="k-ev">—</strong></div>
        <p id="k-note" class="text-xs text-zinc-400 pt-1"></p>
      </div>
    </section>

    <!-- EV TAB -->
    <section data-panel="ev" class="space-y-4 hidden">
      <h2 class="sr-only">Expected Value</h2>

      <div class="grid grid-cols-2 gap-3">
        <label class="block">
          <span class="text-xs text-zinc-400">Decimal Odds</span>
          <input id="e-odds" type="number" step="0.01" min="1.01"
                 class="mt-1 w-full bg-zinc-900 border border-zinc-800 rounded-md px-3 py-2"
                 placeholder="e.g., 1.75">
        </label>
        <label class="block">
          <span class="text-xs text-zinc-400">Win Prob. (p %)</span>
          <input id="e-prob" type="number" step="0.1" min="0" max="100"
                 class="mt-1 w-full bg-zinc-900 border border-zinc-800 rounded-md px-3 py-2"
                 placeholder="e.g., 60">
        </label>
      </div>

      <div class="flex gap-2">
        <button id="e-calc" class="btn bg-white/90 text-black">Calculate</button>
        <button id="e-clear" class="btn bg-zinc-800">Clear</button>
      </div>

      <div id="e-out" class="rounded-lg border border-zinc-800 bg-zinc-900 p-3 text-sm space-y-1 hidden">
        <div class="flex items-center justify-between"><span class="text-zinc-400">EV per $1</span><strong id="e-ev">—</strong></div>
        <div class="flex items-center justify-between"><span class="text-zinc-400">Edge vs Break-even</span><strong id="e-edge">—</strong></div>
        <div class="flex items-center justify-between"><span class="text-zinc-400">Break-even p*</span><strong id="e-be">—</strong></div>
        <p class="text-xs text-zinc-400 pt-1">EV = p × odds − 1</p>
      </div>
    </section>

    <!-- NBL HELPER TAB (lightweight placeholder you can extend) -->
    <section data-panel="nbl" class="space-y-4 hidden">
      <h2 class="sr-only">NBL Helper</h2>

      <div class="rounded-lg border border-zinc-800 bg-zinc-900 p-3 text-sm space-y-3">
        <p class="text-zinc-300">Quick entry for NBL lines:</p>
        <div class="grid grid-cols-2 gap-3">
          <label class="block">
            <span class="text-xs text-zinc-400">Team A Win %</span>
            <input id="n-a" type="number" step="0.1" min="0" max="100"
                   class="mt-1 w-full bg-zinc-950 border border-zinc-800 rounded-md px-3 py-2" placeholder="e.g., 54">
          </label>
          <label class="block">
            <span class="text-xs text-zinc-400">Team B Win %</span>
            <input id="n-b" type="number" step="0.1" min="0" max="100"
                   class="mt-1 w-full bg-zinc-950 border border-zinc-800 rounded-md px-3 py-2" placeholder="e.g., 46">
          </label>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <label class="block">
            <span class="text-xs text-zinc-400">Odds A</span>
            <input id="n-oa" type="number" step="0.01" min="1.01"
                   class="mt-1 w-full bg-zinc-950 border border-zinc-800 rounded-md px-3 py-2" placeholder="1.85">
          </label>
          <label class="block">
            <span class="text-xs text-zinc-400">Odds B</span>
            <input id="n-ob" type="number" step="0.01" min="1.01"
                   class="mt-1 w-full bg-zinc-950 border border-zinc-800 rounded-md px-3 py-2" placeholder="2.05">
          </label>
        </div>
        <div class="flex gap-2">
          <button id="n-calc" class="btn bg-white/90 text-black">Compare EV</button>
          <button id="n-clear" class="btn bg-zinc-800">Clear</button>
        </div>
        <div id="n-out" class="text-sm space-y-1 hidden">
          <div class="flex items-center justify-between"><span class="text-zinc-400">EV A</span><strong id="n-eva">—</strong></div>
          <div class="flex items-center justify-between"><span class="text-zinc-400">EV B</span><strong id="n-evb">—</strong></div>
          <div class="flex items-center justify-between"><span class="text-zinc-400">Better Side</span><strong id="n-best">—</strong></div>
        </div>
      </div>
      <p class="text-xs text-zinc-500">Tip: Long-press outputs to copy.</p>
    </section>
  </main>

  <!-- Bottom bar with quick actions -->
  <footer class="safe fixed bottom-0 inset-x-0 bg-black/85 backdrop-blur border-t border-zinc-800">
    <div class="max-w-screen-sm mx-auto px-3 py-2 flex items-center justify-between">
      <div class="text-xs text-zinc-400">Auto-save on change</div>
      <button id="quick-half" class="btn bg-zinc-800 text-zinc-100">Half-Kelly</button>
    </div>
  </footer>

  <script>
    // ---------- helpers ----------
    const $ = (sel) => document.querySelector(sel);
    const show = (el) => el.classList.remove('hidden');
    const hide = (el) => el.classList.add('hidden');
    const fmt = (n, d=2) => isFinite(n) ? (n).toFixed(d) : '—';
    const toPct = (f, d=2) => isFinite(f) ? (f*100).toFixed(d) + '%' : '—';

    // ---------- tab logic ----------
    const tabBtns = [...document.querySelectorAll('#tabs [data-tab]')];
    const panels = [...document.querySelectorAll('[data-panel]')];
    function activateTab(name){
      tabBtns.forEach(b => b.classList.toggle('bg-zinc-800', b.dataset.tab === name));
      panels.forEach(p => p.classList.toggle('hidden', p.dataset.panel !== name));
      localStorage.setItem('tab', name);
    }
    tabBtns.forEach(b => b.addEventListener('click', () => activateTab(b.dataset.tab)));
    activateTab(localStorage.getItem('tab') || 'kelly');

    // ---------- persistence ----------
    const persist = (ids) => {
      ids.forEach(id => {
        const el = $('#'+id);
        const key = 'evk:'+id;
        // load
        const v = localStorage.getItem(key);
        if (v !== null) el.value = v;
        // save on input
        el.addEventListener('input', () => localStorage.setItem(key, el.value));
      });
    };
    persist(['k-odds','k-prob','k-bank','k-frac','e-odds','e-prob','n-a','n-b','n-oa','n-ob']);

    // ---------- Kelly calc ----------
    function calcKelly() {
      const odds = parseFloat($('#k-odds').value);
      const pPct = parseFloat($('#k-prob').value);
      const bank = parseFloat($('#k-bank').value);
      const frac = parseFloat($('#k-frac').value);

      const out = $('#k-out');
      if (!odds || !pPct || !bank || frac===null || isNaN(frac)) { hide(out); return; }

      const p = pPct/100;
      const b = odds - 1;
      const q = 1 - p;
      const kelly = (b*p - q) / b; // Kelly fraction of bankroll
      const kAdj = Math.max(0, kelly); // don't go negative; zero stake if no edge
      const stake = bank * kAdj * Math.min(1, Math.max(0, frac));

      const evPerUnit = p*odds - 1;

      $('#k-kellyPct').textContent = toPct(kAdj);
      $('#k-stake').textContent = '$' + fmt(stake, 2);
      $('#k-ev').textContent = fmt(evPerUnit, 3);

      const be = 1/odds; // break-even probability
      const edge = p - be;
      $('#k-note').textContent = `Edge vs break-even: ${toPct(edge)}  |  Break-even p*: ${toPct(be)}`;

      show(out);
    }
    $('#k-calc').addEventListener('click', calcKelly);
    ['k-odds','k-prob','k-bank','k-frac'].forEach(id => $('#'+id).addEventListener('change', calcKelly));
    $('#k-clear').addEventListener('click', () => {
      ['k-odds','k-prob','k-bank','k-frac'].forEach(id => { $('#'+id).value = ''; localStorage.removeItem('evk:'+id); });
      hide($('#k-out'));
    });

    // quick action sets half-kelly fraction and recalcs
    $('#quick-half').addEventListener('click', () => { $('#k-frac').value = 0.5; calcKelly(); });

    // ---------- EV calc ----------
    function calcEV() {
      const odds = parseFloat($('#e-odds').value);
      const pPct = parseFloat($('#e-prob').value);
      const out = $('#e-out');
      if (!odds || !pPct) { hide(out); return; }

      const p = pPct/100;
      const ev = p*odds - 1;
      const be = 1/odds;
      const edge = p - be;

      $('#e-ev').textContent = fmt(ev, 3);
      $('#e-edge').textContent = toPct(edge);
      $('#e-be').textContent = toPct(be);
      show(out);
    }
    $('#e-calc').addEventListener('click', calcEV);
    ['e-odds','e-prob'].forEach(id => $('#'+id).addEventListener('change', calcEV));
    $('#e-clear').addEventListener('click', () => {
      ['e-odds','e-prob'].forEach(id => { $('#'+id).value = ''; localStorage.removeItem('evk:'+id); });
      hide($('#e-out'));
    });

    // ---------- NBL helper ----------
    function calcNBL(){
      const a = parseFloat($('#n-a').value)/100;
      const b = parseFloat($('#n-b').value)/100;
      const oa = parseFloat($('#n-oa').value);
      const ob = parseFloat($('#n-ob').value);
      const out = $('#n-out');
      if (![a,b,oa,ob].every(x => isFinite(x) && x>0)) { hide(out); return; }
      const eva = a*oa - 1;
      const evb = b*ob - 1;
      $('#n-eva').textContent = fmt(eva,3);
      $('#n-evb').textContent = fmt(evb,3);
      $('#n-best').textContent = (eva === evb) ? 'Equal' : (eva > evb ? 'Team A' : 'Team B');
      show(out);
    }
    $('#n-calc').addEventListener('click', calcNBL);
    ['n-a','n-b','n-oa','n-ob'].forEach(id => $('#'+id).addEventListener('change', calcNBL));
    $('#n-clear').addEventListener('click', () => {
      ['n-a','n-b','n-oa','n-ob'].forEach(id => { $('#'+id).value = ''; localStorage.removeItem('evk:'+id); });
      hide($('#n-out'));
    });

    // initial autocalc if values exist
    window.addEventListener('load', () => { calcKelly(); calcEV(); calcNBL(); });
  </script>
</body>
</html>
